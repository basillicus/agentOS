Bootstrap: docker
From: python:3.11-slim

%post
    # Install system dependencies
    apt-get update && apt-get install -y git curl zstd
    
    # Install Ollama
    curl -fsSL https://ollama.com/install.sh | sh
    
    # Clean up
    apt-get clean && rm -rf /var/lib/apt/lists/*

%files
    . /app
    entrypoint.sh /app/entrypoint.sh

%post
    cd /app
    pip install --upgrade pip
    pip install --no-cache-dir -r requirements.txt
    chmod +x /app/entrypoint.sh

%environment
    export PYTHONPATH=/app/agentOS
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    
    # Ollama Configuration
    export OLLAMA_HOST=127.0.0.1:11434
    export OLLAMA_MODELS=/root/.ollama/models
    
    # Agent Defaults
    export AGENT_MODEL=granite4
    export AGENTOS_DATA_DIR=/data

%runscript
    exec /app/entrypoint.sh "$@"

%labels
    Author David
    Version 0.1.0
    Description AgentOS Apptainer Image (with Ollama Runtime)